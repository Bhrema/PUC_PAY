<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PUCPAY - Altere Dados</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="../node_modules/@fortawesome/fontawesome-free/css/all.min.css">
  <!-- icheck bootstrap -->
  <link rel="stylesheet" href="node_modules/bootstrap/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="../node_modules/admin-lte/dist/css/adminlte.min.css">

  <!-- <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css"> -->
</head>

<body class="hold-transition register-page">
  <div class="register-box">
    <div class="card card-outline card-primary">
      <div class="card-header text-center">
        <a href="#" class="h1"><b>PUC</b>PAY</a>
      </div>
      <div class="card-body">
        <p class="login-box-msg">Mude os Campos Necessários</p>

        <form id="register-form">

          <div class="input-group mb-3">
            <input id="formEmail" type="email" class="form-control" placeholder="Email" name="email">
            <!--Input de EMAIL-->
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-envelope"></span>
              </div>
            </div>
            <span id="spanErrorEmail" class="invalid-feedback">Insira um e-mail válido</span>
            <!--Span que aparece caso o Regex não retorne True-->
          </div>

          <div class="input-group mb-3">
            <input id="formNome" type="text" class="form-control" placeholder="Nome Completo" name="name">
            <!--Input de Nome-->
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-user"></span>
              </div>
            </div>
            <span id="spanErrorName" class="invalid-feedback">Nome completo sem símbolos</span>
            <!--Span que aparece caso o Regex não retorne True-->
          </div>

          <div class="input-group mb-3" id="cpf_div">
            <input id="formCpf" type="text" class="form-control" placeholder="CPF" name="cpf">
            <!--Input de Cpf/Cnpj (por enquanto)-->
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-id-card"></span>
              </div>
            </div>
            <span id="spanErrorCpf" class="invalid-feedback">CPF inválido / Somente números</span>
            <!--Span que aparece caso o Regex não retorne True-->
          </div>


          <div class="input-group mb-3">
            <input id="formPassword" type="password" class="form-control" placeholder="Password" name="password">
            <!--Input de senha-->
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
            <span id="spanErrorPassword" class="invalid-feedback"> Senha com pelo menos 8 caracteres, pelo menos uma
              letra maiúscula, uma letra minúscula, um número e um caractere especial.</span>
            <!--Span que aparece caso o Regex não retorne True-->
          </div>
          <div class="input-group mb-3">
            <input id="formValidatePassword" type="password" class="form-control" placeholder="Confirme Senha"
              name="password"> <!--Input de senha-->
            <div class="input-group-append">
              <div class="input-group-text">
                <span class="fas fa-lock"></span>
              </div>
            </div>
            <span id="spanErrorValidatePassword" class="invalid-feedback">Insira a mesma senha</span>
            <!--Span que aparece caso o Regex não retorne True-->
          </div>
          <!-- /.col -->
          <div class="col-5">
            <button type="submit" class="btn btn-primary btn-block" id="register-button">Confirmar</button>
          </div>
          <!-- /.col -->
      </div>
      </form>
    </div>
    <!-- /.form-box -->
  </div><!-- /.card -->
  </div>
  <!-- /.register-box -->

  <!-- <script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script> -->

  <script>
    const set_cnpj = () => {
      document.getElementById("cnpj_div").style.display = "flex";
      document.getElementById("cpf_div").style.display = "none";
      document.getElementById("endereco").style.display = "block";
    }
    const set_cpf = () => {
      document.getElementById("cpf_div").style.display = "flex";
      document.getElementById("cnpj_div").style.display = "none";
      document.getElementById("endereco").style.display = "none";
    }

    const form = document.getElementById('register-form') // Captura o formulário

    // Regex de email para o cadastro de usuário
    // const emailInput = document.getElementById('formEmail'); // Captura o input de email
    // const emailFeedback = document.getElementById('spanErrorEmail'); // Captura o span de Erro
    // emailInput.addEventListener('input', () => {
    //   const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    //   const emailValue = emailInput.value;

    //   if (emailRegex.test(emailValue)) {
    //     emailInput.classList.remove('is-invalid');
    //     emailInput.classList.add('is-valid');
    //     emailFeedback.style.display = 'none';
    //   } else {
    //     emailInput.classList.remove('is-valid');
    //     emailInput.classList.add('is-invalid');
    //     emailFeedback.style.display = 'block';
    //   }
    // });

    // const nameInput = document.getElementById('formNome');
    // const nameFeedback = document.getElementById('spanErrorName')
    // // Regex de Nome para cadastro de usuário
    // nameInput.addEventListener('input', () => {
    //   const nameRegex = /^[A-Za-zÀ-ÖØ-öø-ÿ]+([\s-][A-Za-zÀ-ÖØ-öø-ÿ]+)+$/
    //   const nameValue = nameInput.value;

    //   if (nameRegex.test(nameValue)) {
    //     nameInput.classList.remove('is-invalid');
    //     nameInput.classList.add('is-valid');
    //     nameFeedback.style.display = 'none';
    //   } else {
    //     nameInput.classList.remove('is-valid');
    //     nameInput.classList.add('is-invalid');
    //     nameFeedback.style.display = 'block';
    //   }
    // }); 

    // const cpfInput = document.getElementById('formCpf')
    // const cpfFeedback = document.getElementById('spanErrorCpf')
    // // Regex de Cpf para cadastro de usuário
    // cpfInput.addEventListener('input', () => {
    //   const cpfRegex = /^\d{11}$/
    //   const cpfValue = cpfInput.value

    //   if (cpfRegex.test(cpfValue)) {
    //     cpfInput.classList.remove('is-invalid')
    //     cpfInput.classList.add('is-valid')
    //     cpfFeedback.style.display = 'none'
    //   }
    //   else {
    //     cpfInput.classList.remove('is-valid')
    //     cpfInput.classList.add('is-invalid')
    //     cpfFeedback.style.display = 'block'
    //   }
    // })

    // const cnpjInput = document.getElementById('formCnpj')
    // const cnpjFeedback = document.getElementById('spanErrorCnpj')
    // // Regex de CNPJ para cadastro de restaurantes
    // cnpjInput.addEventListener('input', () => {
    //   const cnpjRegex = /^\d{14}$/
    //   const cnpjValue = cnpjInput.value

    //   if (cnpjRegex.test(cnpjValue)) {
    //     cnpjInput.classList.remove('is-invalid')
    //     cnpjInput.classList.add('is-valid')
    //     cnpjFeedback.style.display = 'none'
    //   }
    //   else {
    //     cnpjInput.classList.remove('is-valid')
    //     cnpjInput.classList.add('is-invalid')
    //     cnpjFeedback.style.display = 'block'
    //   }
    // })

    // const enderecoInput = document.getElementById('enderecoInput')
    // const enderecoFeedback = document.getElementById('spanErrorEndereco')
    // // Regex de endereço(bloco) para restaurantes
    // enderecoInput.addEventListener('click', () => {
    //   const enderecoValue = enderecoInput.value
    //   if (enderecoValue === '') {
    //     enderecoInput.classList.remove('is-valid')
    //     enderecoInput.classList.add('is-invalid')
    //     enderecoFeedback.style.display = 'block'
    //   }
    //   else {
    //     enderecoInput.classList.remove('is-invalid')
    //     enderecoInput.classList.add('is-valid')
    //     enderecoFeedback.style.display = 'none'
    //   }
    // })

    // const passwordInput = document.getElementById('formPassword');
    // const passwordFeedback = document.getElementById('spanErrorPassword')
    // // Regex de senha para cadastro de usuário
    // passwordInput.addEventListener('input', () => {
    //   const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+}{"':;?\/>.<,])(?=.*[^\s]).{8,}$/;
    //   const passwordValue = passwordInput.value;

    //   if (passwordRegex.test(passwordValue)) {
    //       passwordInput.classList.remove('is-invalid');
    //       passwordInput.classList.add('is-valid');
    //       passwordFeedback.style.display = 'none';
    //   } else {
    //       passwordInput.classList.remove('is-valid');
    //       passwordInput.classList.add('is-invalid');
    //       passwordFeedback.style.display = 'block';
    //     }
    // });

    // const validatePasswordInput = document.getElementById('formValidatePassword')
    // const validatePassFeedback = document.getElementById('spanErrorValidatePassword')
    // // Regex de validar senha
    // validatePasswordInput.addEventListener('input', () => {
    //   const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()_+}{"':;?\/>.<,])(?=.*[^\s]).{8,}$/;
    //   const validatePassValue = validatePasswordInput.value

    //   if (validatePassValue === passwordInput.value && passwordRegex.test(validatePassValue)) {
    //       validatePasswordInput.classList.remove('is-invalid');
    //       validatePasswordInput.classList.add('is-valid');
    //       validatePassFeedback.style.display = 'none';
    //   }
    //   else {
    //       validatePasswordInput.classList.remove('is-valid');
    //       validatePasswordInput.classList.add('is-invalid');
    //       validatePassFeedback.style.display = 'block';
    //   }

    // }
    // )

    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get("id");
    const register = async (data) => {
      const response = await fetch(`http://localhost:3000/auth/${userId}`, { 
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json' 
        },
        body: JSON.stringify(data)
      })
      const responseData = await response.json();

      console.log(responseData);

      return responseData;
    }

    form.addEventListener('submit', event => {
      event.preventDefault()
      handleRegister()
    })
    async function handleRegister() {
      const formData = new FormData(form);
      const data = {};

      formData.forEach((value, key) => {
        data[key] = value;
      });

      const response = await register(data)

        window.location.replace('dashboard-adm-view-users.html')
      
    }


    async function showUser() {
   
      const response = await fetch(
        `http://localhost:3000/auth/${userId}`,
        {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        }
      );
      const responseData = await response.json();
      const user = responseData;
      console.log(user);
      document.getElementById("formNome").value = user.name;
      document.getElementById("formEmail").value = user.email;
      document.getElementById("formCpf").value = user.cpf;
      document.getElementById("formPassword").value = user.senha;
      document.getElementById("formValidatePassword").value = user.senha;
    }

    showUser()
  
  </script>

  <!-- jQuery -->
  <script src="../../plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE App -->
  <script src="../../dist/js/adminlte.min.js"></script>
</body>

</html>